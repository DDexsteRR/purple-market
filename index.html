<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PURPLE LABEL</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        :root {
            --black: #0a0a0a;
            --black-light: #1a1a1a;
            --purple: #9333ea;
            --purple-dark: #7e22ce;
            --purple-glow: rgba(147, 51, 234, 0.4);
            --white: #ffffff;
            --gray: #a0a0a0;
            --dark-gray: #2d2d2d;
        }

        body {
            background: var(--black);
            color: var(--white);
            padding: 12px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* –®–∞–ø–∫–∞ - –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 10px 16px;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid var(--purple-glow);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .back-btn {
            background: var(--black-light);
            border: 1px solid var(--purple);
            color: var(--white);
            font-size: 14px;
            padding: 6px 14px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .badge {
            background: var(--purple);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –ú–ò–ù–ò–ú–ê–õ–¨–ù–ê–Ø */
        .user-mini {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: rgba(26,26,26,0.9);
            border: 1px solid var(--purple);
            border-radius: 16px;
            margin-bottom: 16px;
        }

        .user-name {
            font-size: 16px;
            font-weight: 600;
        }

        .role-tag {
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 20px;
            background: var(--purple);
            color: white;
        }

        .role-tag.viewer {
            background: #2d2d2d;
            border: 1px solid var(--purple);
        }

        /* –ö–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã - –ú–ê–õ–ï–ù–¨–ö–ê–Ø */
        .cart-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: var(--black-light);
            border: 1px solid var(--purple);
            border-radius: 30px;
            color: white;
            font-size: 14px;
            margin-bottom: 16px;
            margin-left: auto;
        }

        .cart-count {
            background: var(--purple);
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 12px;
        }

        /* –ú–µ–Ω—é - –ö–†–£–ü–ù–´–ï –ö–ù–û–ü–ö–ò */
        .menu-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .menu-btn {
            background: rgba(26,26,26,0.9);
            border: 2px solid var(--purple);
            border-radius: 16px;
            padding: 18px 20px;
            font-size: 18px;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .menu-btn.small {
            padding: 14px 20px;
            font-size: 16px;
            border-color: var(--gray);
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü—ã */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ */
        .product-card {
            background: rgba(26,26,26,0.9);
            border: 1px solid var(--purple);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .product-image {
            height: 160px;
            background: linear-gradient(145deg, #1a1a1a, #0a0a0a);
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px dashed var(--purple);
        }

        .product-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .product-category {
            color: var(--gray);
            font-size: 13px;
            margin-bottom: 12px;
        }

        /* –¶–µ–Ω—ã - –°–ï–¢–ö–ê */
        .prices-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            margin: 12px 0;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
        }

        .price-item {
            text-align: center;
        }

        .price-currency {
            font-size: 10px;
            color: var(--gray);
        }

        .price-value {
            font-size: 14px;
            font-weight: 700;
        }

        .cny { color: #ff6b6b; }
        .bun { color: #fbbf24; }
        .rub { color: #60a5fa; }
        .kzt { color: #34d399; }
        .usd { color: #4ade80; }

        /* –ö–Ω–æ–ø–∫–∏ */
        .add-btn {
            background: var(--purple);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px;
            font-size: 15px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
        }

        .submit-btn {
            background: var(--purple);
            color: white;
            border: none;
            border-radius: 14px;
            padding: 16px;
            font-size: 16px;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            margin-top: 16px;
        }

        .delete-btn {
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px;
            width: 100%;
            margin-top: 12px;
            font-size: 14px;
        }

        /* –ö–æ—Ä–∑–∏–Ω–∞ */
        .cart-item {
            background: rgba(26,26,26,0.9);
            border: 1px solid var(--purple);
            border-radius: 14px;
            padding: 14px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-total {
            background: rgba(147,51,234,0.1);
            border: 1px solid var(--purple);
            border-radius: 14px;
            padding: 16px;
            text-align: center;
            margin: 16px 0;
        }

        .cart-total-price {
            font-size: 28px;
            font-weight: 800;
            color: var(--purple);
        }

        /* –í–∞–ª—é—Ç—ã */
        .currency-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 12px 0;
        }

        .currency-option {
            background: var(--black-light);
            border: 1px solid var(--dark-gray);
            border-radius: 10px;
            padding: 10px 4px;
            text-align: center;
            cursor: pointer;
        }

        .currency-option.active {
            border-color: var(--purple);
            background: rgba(147,51,234,0.2);
        }

        /* –û–ø–ª–∞—Ç–∞ */
        .payment-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 12px 0;
        }

        .payment-option {
            background: var(--black-light);
            border: 1px solid var(--dark-gray);
            border-radius: 12px;
            padding: 14px;
            text-align: center;
            cursor: pointer;
        }

        .payment-option.active {
            border-color: var(--purple);
            background: rgba(147,51,234,0.2);
        }

        /* –§–æ—Ä–º—ã */
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 14px 16px;
            background: var(--black-light);
            border: 1px solid var(--dark-gray);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            margin-top: 6px;
        }

        .form-label {
            font-size: 13px;
            color: var(--purple);
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 16px;
        }

        /* –ö–æ–Ω—Ç–∞–∫—Ç—ã */
        .contact-info {
            background: rgba(26,26,26,0.9);
            border: 1px solid var(--purple);
            border-radius: 14px;
            padding: 16px;
            margin: 16px 0;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 8px;
        }

        /* –ó–∞—è–≤–∫–∏ */
        .request-card {
            background: rgba(26,26,26,0.9);
            border: 1px solid var(--purple);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
            border: 2px dashed var(--purple);
            border-radius: 20px;
        }

        .message {
            background: rgba(147,51,234,0.2);
            border: 1px solid var(--purple);
            color: white;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 16px;
            display: none;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–ê–ü–ö–ê - –¢–û–õ–¨–ö–û –ù–ê–ó–í–ê–ù–ò–ï –ò –ù–ê–ó–ê–î -->
        <div class="header">
            <button class="back-btn" id="backBtn" style="display: none;">‚Üê –ù–∞–∑–∞–¥</button>
            <h1 id="pageTitle">PURPLE LABEL</h1>
            <span class="badge" id="userBadge">...</span>
        </div>

        <!-- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ - –ú–ò–ù–ò–ú–ê–õ–¨–ù–û -->
        <div class="user-mini">
            <span class="user-name" id="displayName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            <span id="roleBadge"></span>
        </div>

        <!-- –°–û–û–ë–©–ï–ù–ò–Ø -->
        <div class="message" id="messageBox"></div>

        <!-- –ö–û–†–ó–ò–ù–ê - –ú–ê–õ–ï–ù–¨–ö–ê–Ø –ö–ù–û–ü–ö–ê -->
        <button class="cart-btn" id="cartBtn">
            üõí –ö–æ—Ä–∑–∏–Ω–∞ <span class="cart-count" id="cartCount">0</span>
        </button>

        <!-- ============ –ì–õ–ê–í–ù–ê–Ø ============ -->
        <div id="pageMain" class="page active">
            <div class="menu-grid">
                <button class="menu-btn" id="btnStock">
                    <span>üì¶</span> –í–∏—Ç—Ä–∏–Ω–∞
                    <span>‚Üí</span>
                </button>
                
                <button class="menu-btn" id="btnMyProduct">
                    <span>üëï</span> –°–≤–æ–π —Ç–æ–≤–∞—Ä
                    <span>‚Üí</span>
                </button>

                <button class="menu-btn admin-only" id="btnChats" style="display: none;">
                    <span>üí¨</span> –ó–∞—è–≤–∫–∏
                    <span>‚Üí</span>
                </button>

                <button class="menu-btn small" id="btnReport">
                    <span>‚ö†Ô∏è</span> –ü—Ä–æ–±–ª–µ–º–∞
                    <span>‚Üí</span>
                </button>
            </div>
        </div>

        <!-- ============ –í–ò–¢–†–ò–ù–ê ============ -->
        <div id="pageStock" class="page">
            <!-- –ê–î–ú–ò–ù–ö–ê -->
            <div id="adminStockControls" style="display: none;">
                <h2 style="color: var(--purple); font-size: 20px; margin-bottom: 16px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å</h2>
                
                <div class="form-group">
                    <input type="text" class="form-input" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                </div>
                <div class="form-group">
                    <input type="text" class="form-input" id="productCategory" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è">
                </div>
                <div class="form-group">
                    <input type="text" class="form-input" id="productSizes" placeholder="–†–∞–∑–º–µ—Ä—ã">
                </div>

                <div style="display: grid; grid-template-columns: repeat(5,1fr); gap: 6px; margin-bottom: 16px;">
                    <input type="number" class="form-input" id="priceCNY" placeholder="CNY" style="padding: 10px;">
                    <input type="number" class="form-input" id="priceBUN" placeholder="BUN" style="padding: 10px;">
                    <input type="number" class="form-input" id="priceRUB" placeholder="RUB" style="padding: 10px;">
                    <input type="number" class="form-input" id="priceKZT" placeholder="KZT" style="padding: 10px;">
                    <input type="number" class="form-input" id="priceUSD" placeholder="USD" style="padding: 10px;">
                </div>

                <button class="submit-btn" id="addProductBtn" style="margin-top: 0;">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                <hr style="border: 1px solid #2d2d2d; margin: 24px 0;">
            </div>

            <h2 style="color: var(--purple); font-size: 20px; margin-bottom: 16px;">üìã –¢–æ–≤–∞—Ä—ã</h2>
            <div id="stockProductsList"></div>
        </div>

        <!-- ============ –ö–û–†–ó–ò–ù–ê ============ -->
        <div id="pageCart" class="page">
            <h2 style="color: var(--purple); font-size: 22px; margin-bottom: 16px;">üõí –ö–æ—Ä–∑–∏–Ω–∞</h2>
            <div id="cartItemsList"></div>
            <div id="cartEmpty" class="empty-state" style="display: none;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>

            <div id="cartCheckoutSection" style="display: none;">
                <div class="cart-total">
                    <div style="font-size: 14px; color: var(--gray);">–ò—Ç–æ–≥–æ</div>
                    <div class="cart-total-price" id="cartTotalPrice">0</div>
                    <div style="font-size: 14px; color: var(--gray);" id="cartTotalCurrency">CNY</div>
                </div>

                <!-- –í–ê–õ–Æ–¢–ê -->
                <div class="currency-selector" id="checkoutCurrencySelector">
                    <div class="currency-option active" data-currency="CNY">üá®üá≥ CNY</div>
                    <div class="currency-option" data-currency="BUN">üü° BUN</div>
                    <div class="currency-option" data-currency="RUB">üá∑üá∫ RUB</div>
                    <div class="currency-option" data-currency="KZT">üá∞üáø KZT</div>
                    <div class="currency-option" data-currency="USD">üá∫üá∏ USD</div>
                </div>

                <!-- –û–ü–õ–ê–¢–ê -->
                <div class="payment-methods">
                    <div class="payment-option active" id="paymentCash">üíµ –ù–∞–ª–∏—á–Ω—ã–µ</div>
                    <div class="payment-option" id="paymentCard">üí≥ –ö–∞—Ä—Ç–∞</div>
                </div>

                <!-- –ö–û–ù–¢–ê–ö–¢–´ -->
                <div class="form-group">
                    <input type="text" class="form-input" id="checkoutContact" placeholder="–í–∞—à @username">
                </div>
                <div class="form-group">
                    <textarea class="form-textarea" id="checkoutAddress" placeholder="–ê–¥—Ä–µ—Å / –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" rows="2"></textarea>
                </div>

                <!-- –°–í–Ø–ó–¨ –° –ù–ê–ú–ò -->
                <div class="contact-info">
                    <div style="color: var(--purple); font-weight: 600; margin-bottom: 10px;">üìû –°–≤—è–∑—å</div>
                    <div class="contact-item">üí¨ @dex_s_ter / @AR1TIG</div>
                    <div class="contact-item">‚è∞ c 15:00 –¥–æ 21:00 –æ–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç</div>
                </div>

                <button class="submit-btn" id="checkoutBtn">‚úÖ –û—Ñ–æ—Ä–º–∏—Ç—å</button>
            </div>
        </div>

        <!-- ============ –°–í–û–ô –¢–û–í–ê–† ============ -->
        <div id="pageMyProduct" class="page">
            <h2 style="color: var(--purple); font-size: 22px; margin-bottom: 16px;">üëï –°–≤–æ–π —Ç–æ–≤–∞—Ä</h2>
            
            <div class="form-group">
                <input type="text" class="form-input" id="productTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
            </div>
            <div class="form-group">
                <input type="text" class="form-input" id="productCategory2" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è">
            </div>
            <div class="form-group">
                <input type="text" class="form-input" id="contactUsername" placeholder="–í–∞—à @username">
            </div>
            <div class="form-group">
                <textarea class="form-textarea" id="productComment" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ, —Ä–∞–∑–º–µ—Ä—ã" rows="3"></textarea>
            </div>

            <button class="submit-btn" id="sendRequestBtn">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>

        <!-- ============ –ü–†–û–ë–õ–ï–ú–ê ============ -->
        <div id="pageReport" class="page">
            <h2 style="color: var(--purple); font-size: 22px; margin-bottom: 16px;">‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞</h2>
            
            <div class="form-group">
                <select class="form-select" id="reportTopic">
                    <option>–û—à–∏–±–∫–∞</option>
                    <option>–ó–∞–∫–∞–∑</option>
                    <option>–û–ø–ª–∞—Ç–∞</option>
                    <option>–î–æ—Å—Ç–∞–≤–∫–∞</option>
                    <option>–î—Ä—É–≥–æ–µ</option>
                </select>
            </div>
            <div class="form-group">
                <textarea class="form-textarea" id="reportText" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É" rows="3"></textarea>
            </div>
            <div class="form-group">
                <input type="text" class="form-input" id="reportContact" placeholder="–í–∞—à @username">
            </div>

            <button class="submit-btn" id="sendReportBtn">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>

        <!-- ============ –ó–ê–Ø–í–ö–ò (–ê–î–ú–ò–ù–´) ============ -->
        <div id="pageChats" class="page">
            <h2 style="color: var(--purple); font-size: 22px; margin-bottom: 16px;">üí¨ –ó–∞—è–≤–∫–∏</h2>
            <div id="requestsList"></div>
        </div>
    </div>

    <script>
        // ============ –ù–ê–°–¢–†–û–ô–ö–ò ============
        const ADMIN_USERNAMES = ['dex_s_ter', 'AR1TIG'];
        
        // ============ TELEGRAM ============
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // ============ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ ============
        const user = tg.initDataUnsafe?.user;
        const username = user?.username?.toLowerCase() || '';
        const firstName = user?.first_name || 'User';
        const isAdmin = ADMIN_USERNAMES.includes(username);

        // ============ –î–ê–ù–ù–´–ï ============
        let stockProducts = JSON.parse(localStorage.getItem('stockProducts')) || [
            { id: 1, name: 'Nike Air Force 1', category: '–ö—Ä–æ—Å—Å–æ–≤–∫–∏', sizes: '40-45', prices: { cny: 4590, bun: 2200, rub: 45900, kzt: 245000, usd: 110 } },
            { id: 2, name: 'Essentials FOG', category: '–•—É–¥–∏', sizes: 'S-L', prices: { cny: 3890, bun: 1850, rub: 38900, kzt: 210000, usd: 95 } }
        ];

        let userRequests = JSON.parse(localStorage.getItem('userRequests')) || [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        // ============ –≠–õ–ï–ú–ï–ù–¢–´ ============
        const pages = {
            main: document.getElementById('pageMain'),
            stock: document.getElementById('pageStock'),
            cart: document.getElementById('pageCart'),
            myProduct: document.getElementById('pageMyProduct'),
            report: document.getElementById('pageReport'),
            chats: document.getElementById('pageChats')
        };

        const backBtn = document.getElementById('backBtn');
        const pageTitle = document.getElementById('pageTitle');
        const displayNameEl = document.getElementById('displayName');
        const roleBadgeEl = document.getElementById('roleBadge');
        const userBadgeEl = document.getElementById('userBadge');
        const messageBox = document.getElementById('messageBox');
        const cartCount = document.getElementById('cartCount');

        // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============
        function initUser() {
            displayNameEl.textContent = username ? `@${username}` : firstName;
            
            if (isAdmin) {
                userBadgeEl.textContent = '–ê–¥–º–∏–Ω';
                roleBadgeEl.innerHTML = '<span class="role-tag">üëë –ê–¥–º–∏–Ω</span>';
                document.getElementById('btnChats').style.display = 'flex';
                document.getElementById('adminStockControls').style.display = 'block';
            } else {
                userBadgeEl.textContent = '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å';
                roleBadgeEl.innerHTML = '<span class="role-tag viewer">üë§ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å</span>';
            }
        }

        // ============ –ö–û–†–ó–ò–ù–ê ============
        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = count;
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        window.addToCart = function(product) {
            const existing = cart.find(item => item.id === product.id);
            if (existing) {
                existing.quantity += 1;
            } else {
                cart.push({ id: product.id, name: product.name, prices: product.prices, quantity: 1 });
            }
            updateCartCount();
            showMessage('‚úÖ –í –∫–æ—Ä–∑–∏–Ω–µ');
            tg.HapticFeedback?.impactOccurred('light');
        };

        window.removeFromCart = function(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartCount();
            renderCart();
            showMessage('üóë –£–¥–∞–ª–µ–Ω–æ');
        };

        function renderCart() {
            const cartItemsList = document.getElementById('cartItemsList');
            const cartEmpty = document.getElementById('cartEmpty');
            const checkoutSection = document.getElementById('cartCheckoutSection');
            
            if (cart.length === 0) {
                cartItemsList.innerHTML = '';
                cartEmpty.style.display = 'block';
                checkoutSection.style.display = 'none';
                return;
            }

            cartEmpty.style.display = 'none';
            checkoutSection.style.display = 'block';

            let html = '';
            let total = 0;
            const selectedCurrency = document.querySelector('#checkoutCurrencySelector .currency-option.active')?.dataset.currency || 'CNY';

            cart.forEach(item => {
                const product = stockProducts.find(p => p.id === item.id);
                if (!product) return;
                const price = product.prices[selectedCurrency.toLowerCase()] || 0;
                total += price * item.quantity;

                html += `
                    <div class="cart-item">
                        <div>
                            <div style="font-weight: 600;">${product.name}</div>
                            <div style="color: var(--purple); font-size: 15px; margin-top: 4px;">${price} ${selectedCurrency} √ó ${item.quantity}</div>
                        </div>
                        <button class="delete-btn" onclick="removeFromCart(${item.id})" style="width: auto; padding: 8px 16px; margin-top: 0;">‚úï</button>
                    </div>
                `;
            });

            cartItemsList.innerHTML = html;
            document.getElementById('cartTotalPrice').textContent = total;
            document.getElementById('cartTotalCurrency').textContent = selectedCurrency;
        }

        // ============ –ù–ê–í–ò–ì–ê–¶–ò–Ø ============
        function showPage(pageId, title) {
            Object.values(pages).forEach(page => page.classList.remove('active'));
            pages[pageId].classList.add('active');
            pageTitle.textContent = title;
            backBtn.style.display = pageId === 'main' ? 'none' : 'block';
            
            if (pageId === 'stock') renderStockProducts();
            if (pageId === 'cart') renderCart();
            if (pageId === 'chats') renderRequests();
        }

        backBtn.addEventListener('click', () => showPage('main', 'PURPLE LABEL'));
        document.getElementById('cartBtn').addEventListener('click', () => showPage('cart', '–ö–æ—Ä–∑–∏–Ω–∞'));

        // ============ –ö–ù–û–ü–ö–ò ============
        document.getElementById('btnStock').addEventListener('click', () => showPage('stock', '–í–∏—Ç—Ä–∏–Ω–∞'));
        document.getElementById('btnMyProduct').addEventListener('click', () => showPage('myProduct', '–°–≤–æ–π —Ç–æ–≤–∞—Ä'));
        document.getElementById('btnReport').addEventListener('click', () => showPage('report', '–ü—Ä–æ–±–ª–µ–º–∞'));
        document.getElementById('btnChats').addEventListener('click', () => { if (isAdmin) showPage('chats', '–ó–∞—è–≤–∫–∏'); });

        // ============ –¢–û–í–ê–†–´ ============
        function renderStockProducts() {
            const container = document.getElementById('stockProductsList');
            if (stockProducts.length === 0) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</div>';
                return;
            }

            let html = '';
            stockProducts.forEach(product => {
                html += `
                    <div class="product-card">
                        <div class="product-image">üì∏</div>
                        <div class="product-title">${product.name}</div>
                        <div class="product-category">${product.category} ‚Ä¢ ${product.sizes}</div>
                        <div class="prices-grid">
                            <div class="price-item"><div class="price-currency cny">CNY</div><div class="price-value cny">${product.prices.cny}</div></div>
                            <div class="price-item"><div class="price-currency bun">BUN</div><div class="price-value bun">${product.prices.bun}</div></div>
                            <div class="price-item"><div class="price-currency rub">RUB</div><div class="price-value rub">${product.prices.rub}</div></div>
                            <div class="price-item"><div class="price-currency kzt">KZT</div><div class="price-value kzt">${product.prices.kzt}</div></div>
                            <div class="price-item"><div class="price-currency usd">USD</div><div class="price-value usd">${product.prices.usd}</div></div>
                        </div>
                        <button class="add-btn" onclick='addToCart(${JSON.stringify(product)})'>üõí –í –∫–æ—Ä–∑–∏–Ω—É</button>
                        ${isAdmin ? `<button class="delete-btn" onclick="deleteProduct(${product.id})">üóë –£–¥–∞–ª–∏—Ç—å</button>` : ''}
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        window.deleteProduct = function(productId) {
            if (!isAdmin) return;
            stockProducts = stockProducts.filter(p => p.id !== productId);
            localStorage.setItem('stockProducts', JSON.stringify(stockProducts));
            renderStockProducts();
            showMessage('‚úÖ –£–¥–∞–ª–µ–Ω–æ');
        };

        document.getElementById('addProductBtn')?.addEventListener('click', function() {
            if (!isAdmin) return;
            
            const name = document.getElementById('productName').value;
            const category = document.getElementById('productCategory').value;
            const sizes = document.getElementById('productSizes').value;
            if (!name || !sizes) { tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); return; }

            stockProducts.push({
                id: Date.now(),
                name, category: category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', sizes,
                prices: {
                    cny: parseInt(document.getElementById('priceCNY').value) || 0,
                    bun: parseInt(document.getElementById('priceBUN').value) || 0,
                    rub: parseInt(document.getElementById('priceRUB').value) || 0,
                    kzt: parseInt(document.getElementById('priceKZT').value) || 0,
                    usd: parseInt(document.getElementById('priceUSD').value) || 0
                }
            });

            localStorage.setItem('stockProducts', JSON.stringify(stockProducts));
            renderStockProducts();
            showMessage('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ');
            
            // –û—á–∏—Å—Ç–∫–∞
            ['productName','productCategory','productSizes','priceCNY','priceBUN','priceRUB','priceKZT','priceUSD'].forEach(id => 
                document.getElementById(id).value = ''
            );
        });

        // ============ –í–ê–õ–Æ–¢–ê/–û–ü–õ–ê–¢–ê ============
        document.querySelectorAll('#checkoutCurrencySelector .currency-option').forEach(opt => {
            opt.addEventListener('click', function() {
                document.querySelectorAll('#checkoutCurrencySelector .currency-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                renderCart();
            });
        });

        document.getElementById('paymentCash').addEventListener('click', function() {
            document.getElementById('paymentCash').classList.add('active');
            document.getElementById('paymentCard').classList.remove('active');
        });

        document.getElementById('paymentCard').addEventListener('click', function() {
            document.getElementById('paymentCard').classList.add('active');
            document.getElementById('paymentCash').classList.remove('active');
        });

        // ============ –û–§–û–†–ú–õ–ï–ù–ò–ï ============
        document.getElementById('checkoutBtn').addEventListener('click', function() {
            if (cart.length === 0) { tg.showAlert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }

            const currency = document.querySelector('#checkoutCurrencySelector .currency-option.active').dataset.currency;
            const payment = document.querySelector('.payment-option.active')?.innerText.includes('–ù–∞–ª–∏—á–Ω—ã–µ') ? '–ù–∞–ª–∏—á–Ω—ã–µ' : '–ö–∞—Ä—Ç–∞';
            const contact = document.getElementById('checkoutContact').value;
            if (!contact) { tg.showAlert('–£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç'); return; }

            let total = 0;
            const items = cart.map(item => {
                const product = stockProducts.find(p => p.id === item.id);
                const price = product.prices[currency.toLowerCase()];
                total += price * item.quantity;
                return `${product.name} x${item.quantity} = ${price * item.quantity} ${currency}`;
            });

            const order = {
                id: Date.now(), user: username || firstName, items, total, currency, payment,
                contact, address: document.getElementById('checkoutAddress').value || '–ù–µ —É–∫–∞–∑–∞–Ω'
            };

            tg.sendData(JSON.stringify({ action: 'new_order', order }));
            
            userRequests.unshift({ ...order, type: 'order', date: new Date().toLocaleString() });
            localStorage.setItem('userRequests', JSON.stringify(userRequests));
            
            cart = []; updateCartCount();
            showMessage('‚úÖ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!');
            setTimeout(() => showPage('main', 'PURPLE LABEL'), 1500);
        });

        // ============ –ó–ê–Ø–í–ö–ò ============
        document.getElementById('sendRequestBtn').addEventListener('click', function() {
            const title = document.getElementById('productTitle').value;
            if (!title) { tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); return; }

            const request = {
                id: Date.now(), username: username || firstName,
                title, category: document.getElementById('productCategory2').value || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
                contact: document.getElementById('contactUsername').value || username || firstName,
                comment: document.getElementById('productComment').value || '–ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è',
                date: new Date().toLocaleString(), type: 'product_request'
            };

            userRequests.unshift(request);
            localStorage.setItem('userRequests', JSON.stringify(userRequests));
            
            ['productTitle','productCategory2','contactUsername','productComment'].forEach(id => 
                document.getElementById(id).value = ''
            );
            
            showMessage('‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
            tg.sendData(JSON.stringify({ action: 'new_request', request }));
        });

        document.getElementById('sendReportBtn').addEventListener('click', function() {
            const text = document.getElementById('reportText').value;
            if (!text) { tg.showAlert('–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É'); return; }

            const report = {
                id: Date.now(), user: username || firstName,
                topic: document.getElementById('reportTopic').value,
                text, contact: document.getElementById('reportContact').value || username || firstName,
                date: new Date().toLocaleString(), type: 'report'
            };

            userRequests.unshift(report);
            localStorage.setItem('userRequests', JSON.stringify(userRequests));
            
            document.getElementById('reportText').value = '';
            document.getElementById('reportContact').value = '';
            
            showMessage('‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
            tg.sendData(JSON.stringify({ action: 'new_report', report }));
        });

        // ============ –ó–ê–Ø–í–ö–ò –ê–î–ú–ò–ù–û–í ============
        function renderRequests() {
            const container = document.getElementById('requestsList');
            if (userRequests.length === 0) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç –∑–∞—è–≤–æ–∫</div>';
                return;
            }

            let html = '';
            userRequests.forEach(req => {
                if (req.type === 'order') {
                    html += `<div class="request-card">
                        <div style="display:flex; justify-content:space-between;">
                            <span style="color:var(--purple);">üõí –ó–∞–∫–∞–∑</span>
                            <span style="color:var(--gray);">${req.user}</span>
                        </div>
                        <div style="margin:12px 0;">${req.items.join('<br>')}</div>
                        <div style="font-size:18px; font-weight:700; color:var(--purple);">–ò–¢–û–ì–û: ${req.total} ${req.currency}</div>
                        <div style="margin-top:8px;">üí≥ ${req.payment} ‚Ä¢ üìû ${req.contact}</div>
                        <div style="margin-top:4px; color:var(--gray);">üìç ${req.address}</div>
                        <div style="margin-top:8px; font-size:12px; color:var(--gray);">${req.date}</div>
                        <button class="delete-btn" onclick="deleteRequest(${req.id})" style="margin-top:12px;">‚úì –ì–æ—Ç–æ–≤–æ</button>
                    </div>`;
                } else if (req.type === 'report') {
                    html += `<div class="request-card">
                        <div style="display:flex; justify-content:space-between;">
                            <span style="color:#ef4444;">‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞</span>
                            <span style="color:var(--gray);">${req.user}</span>
                        </div>
                        <div style="margin:12px 0; font-weight:600;">${req.topic}</div>
                        <div>${req.text}</div>
                        <div style="margin-top:8px; color:var(--gray);">üìû ${req.contact}</div>
                        <div style="margin-top:8px; font-size:12px; color:var(--gray);">${req.date}</div>
                        <button class="delete-btn" onclick="deleteRequest(${req.id})" style="margin-top:12px;">‚úì –ì–æ—Ç–æ–≤–æ</button>
                    </div>`;
                } else {
                    html += `<div class="request-card">
                        <div style="display:flex; justify-content:space-between;">
                            <span style="color:var(--purple);">üëï –¢–æ–≤–∞—Ä</span>
                            <span style="color:var(--gray);">${req.username}</span>
                        </div>
                        <div style="margin:12px 0; font-weight:600;">${req.title}</div>
                        <div>${req.category}</div>
                        <div style="margin-top:8px;">üí¨ ${req.comment}</div>
                        <div style="margin-top:4px; color:var(--gray);">üìû ${req.contact}</div>
                        <div style="margin-top:8px; font-size:12px; color:var(--gray);">${req.date}</div>
                        <button class="delete-btn" onclick="deleteRequest(${req.id})" style="margin-top:12px;">‚úì –ì–æ—Ç–æ–≤–æ</button>
                    </div>`;
                }
            });
            container.innerHTML = html;
        }

        window.deleteRequest = function(requestId) {
            if (!isAdmin) return;
            userRequests = userRequests.filter(r => r.id !== requestId);
            localStorage.setItem('userRequests', JSON.stringify(userRequests));
            renderRequests();
            showMessage('‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ');
        };

        // ============ –°–û–û–ë–©–ï–ù–ò–Ø ============
        function showMessage(text) {
            messageBox.textContent = text;
            messageBox.style.display = 'block';
            setTimeout(() => messageBox.style.display = 'none', 2000);
        }

        // ============ –°–¢–ê–†–¢ ============
        initUser();
        showPage('main', 'PURPLE LABEL');
        updateCartCount();
    </script>
</body>
</html>
